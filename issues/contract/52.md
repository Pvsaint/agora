# Issue 52: Transition to Escrow-based payment model

### DESCRIPTION

> **Escrow is the foundation for trust on the Agora platform.** By holding guest funds in the contract instead of sending them immediately to the organizer, we can guarantee refunds if an event is cancelled or if there is a dispute. This issue refactors the payment flow to use the contract itself as a temporary custodian of all ticket revenue.

### TASKS

- [ ] **Refactor `process_payment`** to transfer USDC to the `env.current_contract_address()`.
- [ ] **Implement an internal 'Balances' map** that tracks how much revenue belongs to each `event_id`.
- [ ] **Ensure the platform fee** is also tracked within this escrowed balance but flagged for treasury withdrawal.
- [ ] **Integrate security checks** to verify that the contract has received the correct allowance and balance from the buyer.

**Depends on:**
#43
